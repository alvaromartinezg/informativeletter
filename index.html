<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>KMZ Downloader</title>
<style>
  body { font-family: system-ui, Arial, sans-serif; max-width: 640px; margin: 40px auto; text-align:center; }
  h1 { color: #006644; }
  button {
    background:#006644; color:white; border:0; padding:12px 22px;
    border-radius:8px; cursor:pointer; font-size:1rem;
  }
  button[disabled] {opacity:.6; cursor:not-allowed;}
  .muted { color:#555; }
</style>
</head>
<body>
  <h1>Descarga KMZ desde AWS</h1>
  <p class="muted">Genera una URL temporal y descarga el archivo desde S3.</p>
  <button id="btn">Descargar KMZ</button>
  <p id="status" class="muted" style="margin-top:12px;"></p>

<script>
const API_URL = "https://1h7d4k0mcj.execute-api.us-east-2.amazonaws.com/download"; // ejemplo: https://1h7d4k0mcj.execute-api.us-east-2.amazonaws.com/download

document.getElementById("btn").addEventListener("click", async () => {
  const btn = document.getElementById("btn");
  const status = document.getElementById("status");
  btn.disabled = true;
  status.textContent = "Solicitando URL firmada a AWS…";

  try {
    const res = await fetch(API_URL, { method: "GET" });
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    const js = await res.json();
    if (!js.downloadUrl) throw new Error("La API no devolvió downloadUrl.");

    // Inicia descarga directa desde S3 (sin pasar por Lambda)
    const a = document.createElement("a");
    a.href = js.downloadUrl;
    a.download = "Exportado.kmz"; // opcional: muchos navegadores respetan el nombre del objeto
    a.click();

    status.textContent = "Descarga iniciada ✅ (URL válida por unos minutos)";
  } catch (err) {
    status.textContent = "Error: " + err.message;
  } finally {
    btn.disabled = false;
  }
});
</script>
</body>
</html>
