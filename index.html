<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>KMZ Test AWS</title>
<style>
  body { font-family: system-ui, Arial, sans-serif; max-width: 600px; margin: 40px auto; }
  h1 { color: #006644; }
  button { background:#006644; color:white; border:0; padding:10px 18px; border-radius:8px; cursor:pointer; }
  button[disabled] { opacity:0.6; cursor:not-allowed; }
  .card { border:1px solid #ddd; padding:20px; border-radius:12px; }
</style>
</head>
<body>
  <h1>Prueba de conexión AWS</h1>
  <div class="card">
    <p>Presiona el botón para descargar el archivo <code>test.kmz</code> desde AWS S3 a través del backend Lambda.</p>
    <button id="btn">Descargar desde AWS</button>
    <p id="status" style="margin-top:10px;color:#555;"></p>
  </div>

<script>
const API_URL = "###URL_DE_TU_API_GATEWAY###"; // ejemplo: https://abcd1234.execute-api.us-east-1.amazonaws.com/prod

document.getElementById("btn").addEventListener("click", async () => {
  const btn = document.getElementById("btn");
  const status = document.getElementById("status");
  btn.disabled = true;
  status.textContent = "Conectando a AWS Lambda…";

  try {
    const res = await fetch(API_URL);
    if (!res.ok) throw new Error("Respuesta no válida del servidor (" + res.status + ")");
    const js = await res.json();

    if (!js.body) throw new Error("No se recibió el cuerpo de datos.");

    // Convertir Base64 a blob
    const binary = atob(js.body);
    const bytes = new Uint8Array(binary.length);
    for (let i = 0; i < binary.length; i++) bytes[i] = binary.charCodeAt(i);
    const blob = new Blob([bytes], { type: "application/vnd.google-earth.kmz" });

    // Crear enlace de descarga
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "Exportado.kmz";
    a.click();

    status.textContent = "Descarga completada ✅";
  } catch (err) {
    status.textContent = "Error: " + err.message;
  } finally {
    btn.disabled = false;
  }
});
</script>
</body>
</html>
